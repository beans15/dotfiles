#!/usr/bin/env zsh

if [[ ( $OSTYPE == darwin* ) && ( -x $(which reattach-to-user-namespace 2>/dev/null) ) ]]; then
    if [[ ( ${#@} -eq 0 ) ]]; then
        conf=$( cat ~/.tmux.conf <( echo 'set-option -g default-command "reattach-to-user-namespace -l zsh"' ) )
        tmux attach || tmux -f <(echo "$conf") new -n zsh
    elif [[ ( $1 == 'new' ) ]]; then
        conf=$( cat ~/.tmux.conf <( echo 'set-option -g default-command "reattach-to-user-namespace -l zsh"' ) )
        tmux -f <(echo "$conf") new -n zsh "${@[2,${#@}]}"
    else
        tmux "$@"
    fi
else
    tmux "$@"
fi
